"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const typescript_import_locator_1 = require("./typescript-import-locator");
function buildExplicitNpmDependencies(ctx, nodes, addDependency, fileRead) {
    const importLocator = new typescript_import_locator_1.TypeScriptImportLocator(fileRead);
    Object.keys(ctx.fileMap).forEach((source) => {
        Object.values(ctx.fileMap[source]).forEach((f) => {
            importLocator.fromFile(f.file, (importExpr, filePath, type) => {
                const key = Object.keys(nodes).find((k) => isNpmPackageImport(k, importExpr));
                const target = nodes[key];
                if (source && target && target.type === 'npm') {
                    addDependency(type, source, target.name);
                }
            });
        });
    });
}
exports.buildExplicitNpmDependencies = buildExplicitNpmDependencies;
function isNpmPackageImport(p, e) {
    const toMatch = e
        .split(/[\/]/)
        .slice(0, p.startsWith('@') ? 2 : 1)
        .join('/');
    return toMatch === p;
}
